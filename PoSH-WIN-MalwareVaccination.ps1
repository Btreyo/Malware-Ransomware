# TITLE:     PoSH-WIN-MalwareVaccination.ps1
# PLATFORM:  Windows XP, 7, 8.1, 10 Server 2012 R2
# AUTHOR:    Bobbi Trehan-Young
# CREATED:   27/10/2017 15:35
# VERSION:   0.1
# COPYRIGHT (c) eTFLConsultancy. All rights reserved.
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# PURPOSE:   Vaccine for data-encrypting malware Bad Rabbit for infected machines 
#            - this script will create two files then removes inherited permissions from 
#            - the files.  Fix courtesy of: Amit Serper of CyberReason
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# ~~~~~~~~~ CREATE FILES
$FILE1 = "$env:windir\infpub.dat"
$FILE2 = "$env:windir\cscc.dat"

New-Item -Path $FILE1 -type File -verbose
New-Item -Path $FILE2 -type File -verbose

# ~~~~~~~~~ GET PERMISSSION
$ACL = Get-ACL -Path $FILE1
$ACL.SetAccessRuleProtection($True, $True) 
Set-Acl -Path $FILE1 -AclObject $ACL 

$ACL = Get-ACL -Path $FILE2
$ACL.SetAccessRuleProtection($True, $True) 

# ~~~~~~~~~ REMOVE PERMISSSION Inheritance 
$ACL=get-acl $FILE1 
foreach ($access in $ACL.access){ 
$acl.RemoveAccessRule($access) 
} 

$ACL=get-acl $FILE2
foreach ($access in $ACL.access){ 
$ACL.RemoveAccessRule($access)  
} 
